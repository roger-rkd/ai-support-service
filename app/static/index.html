<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NHS AI Health Assistant - Virtual Healthcare Support</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f4f5;
            background-image:
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(0, 94, 184, 0.02) 35px, rgba(0, 94, 184, 0.02) 70px);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #212b32;
        }

        /* NHS Header */
        .nhs-header {
            background: #005eb8;
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .nhs-header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .nhs-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .nhs-logo-icon {
            font-size: 2.5rem;
        }

        .emergency-banner {
            background: #d5281b;
            color: white;
            padding: 0.75rem 2rem;
            text-align: center;
            font-weight: 600;
        }

        .emergency-banner a {
            color: white;
            text-decoration: underline;
            font-weight: 700;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
        }

        .nav-links a:hover {
            opacity: 0.8;
        }

        .container {
            flex: 1;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .hero {
            background: white;
            border-left: 5px solid #005eb8;
            border-radius: 4px;
            padding: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .hero h1 {
            font-size: 2rem;
            color: #005eb8;
            margin-bottom: 1rem;
        }

        .hero-subtitle {
            font-size: 1.1rem;
            color: #4c6272;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .disclaimer-box {
            background: #fff4e5;
            border-left: 4px solid #f9bf00;
            padding: 1.25rem;
            border-radius: 4px;
            margin: 1.5rem 0;
        }

        .disclaimer-box h3 {
            color: #d47500;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .disclaimer-box p {
            color: #4c6272;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .service-card {
            background: white;
            border-top: 4px solid #41b6e6;
            padding: 1.5rem;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(65, 182, 230, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 94, 184, 0.2);
            border-top-color: #005eb8;
        }

        .service-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #e8f4fc 0%, #d0e8f5 100%);
            box-shadow: 0 4px 8px rgba(0, 94, 184, 0.1);
        }

        .service-icon svg {
            width: 40px;
            height: 40px;
            fill: #005eb8;
        }

        .service-card h3 {
            color: #005eb8;
            margin-bottom: 0.75rem;
            font-size: 1.25rem;
        }

        .service-card p {
            color: #4c6272;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .chat-container {
            background: white;
            border-radius: 8px;
            padding: 2.5rem;
            box-shadow: 0 4px 12px rgba(0, 94, 184, 0.15);
            border-left: 5px solid #005eb8;
            display: flex;
            flex-direction: column;
            height: 700px;
            position: relative;
        }

        .chat-container::before {
            content: 'üè•';
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 4rem;
            opacity: 0.05;
        }

        .chat-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e8edee;
            margin-bottom: 1.5rem;
        }

        .chat-header h2 {
            font-size: 1.5rem;
            color: #005eb8;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #78be20;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .action-btn {
            background: white;
            border: 2px solid #005eb8;
            color: #005eb8;
            padding: 0.75rem 1rem;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            text-align: left;
        }

        .action-btn:hover {
            background: #005eb8;
            color: white;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background: #f8f9fa;
            border-radius: 4px;
            margin-bottom: 1.5rem;
        }

        .message {
            display: flex;
            gap: 0.75rem;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: #005eb8;
        }

        .message.assistant .message-avatar {
            background: #41b6e6;
        }

        .message-content {
            background: white;
            padding: 1rem 1.25rem;
            border-radius: 8px;
            max-width: 75%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            line-height: 1.6;
        }

        .message.user .message-content {
            background: #005eb8;
            color: white;
        }

        .message-content p {
            margin: 0.5rem 0;
        }

        .message-content p:first-child {
            margin-top: 0;
        }

        .message-content p:last-child {
            margin-bottom: 0;
        }

        .message-content ul,
        .message-content ol {
            margin: 0.75rem 0;
            padding-left: 1.5rem;
        }

        .message-content li {
            margin: 0.4rem 0;
            line-height: 1.5;
        }

        .message-content strong,
        .message-content b {
            color: #212b32;
            font-weight: 700;
        }

        .message-content a {
            color: #005eb8;
            text-decoration: underline;
            font-weight: 600;
        }

        .message-content a:hover {
            color: #003087;
        }

        .ai-disclaimer {
            background: #fff4e5;
            border-left: 3px solid #f9bf00;
            padding: 0.75rem;
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: #4c6272;
        }

        .loading {
            display: flex;
            gap: 0.4rem;
            padding: 1rem;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #005eb8;
            animation: bounce 1.4s infinite ease-in-out;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .input-container {
            display: flex;
            gap: 1rem;
        }

        .input-container input {
            flex: 1;
            padding: 1rem 1.5rem;
            border: 2px solid #e8edee;
            border-radius: 4px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }

        .input-container input:focus {
            border-color: #005eb8;
        }

        .send-btn {
            background: #005eb8;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .send-btn:hover:not(:disabled) {
            background: #003087;
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .info-section {
            background: white;
            border-radius: 4px;
            padding: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .info-section h2 {
            color: #005eb8;
            margin-bottom: 2rem;
            font-size: 1.75rem;
            text-align: center;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .info-card {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 4px;
            border-top: 3px solid #78be20;
        }

        .info-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .info-card h3 {
            color: #005eb8;
            margin-bottom: 0.75rem;
            font-size: 1.25rem;
        }

        .info-card p {
            color: #4c6272;
            line-height: 1.6;
        }

        .info-card a {
            color: #005eb8;
            text-decoration: underline;
            font-weight: 600;
        }

        .nhs-footer {
            background: #212b32;
            color: #aeb7bd;
            padding: 2rem;
            margin-top: auto;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h4 {
            color: white;
            margin-bottom: 1rem;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section li {
            margin-bottom: 0.5rem;
        }

        .footer-section a {
            color: #aeb7bd;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-section a:hover {
            color: white;
        }

        .footer-bottom {
            max-width: 1200px;
            margin: 2rem auto 0;
            padding-top: 1.5rem;
            border-top: 1px solid #3a4651;
            text-align: center;
            color: #aeb7bd;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 1.5rem;
            }

            .services-grid,
            .quick-actions {
                grid-template-columns: 1fr;
            }

            .chat-container {
                height: 500px;
            }

            .message-content {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <div class="emergency-banner">
        ‚ö†Ô∏è <strong>Emergency?</strong> Call 999 immediately | <strong>Urgent medical help:</strong> Call NHS 24 on <a href="tel:111">111</a>
    </div>

    <header class="nhs-header">
        <div class="nhs-header-content">
            <div class="nhs-logo">
                <span class="nhs-logo-icon">üè•</span>
                <span>NHS AI Health Assistant</span>
            </div>
            <nav class="nav-links">
                <a href="#chat">Virtual Assistant</a>
                <a href="#services">Services</a>
                <a href="#about">About</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <section class="hero">
            <h1>Welcome to Your Virtual Health Assistant</h1>
            <p class="hero-subtitle">Get instant support for common health questions, find your nearest GP, book appointments, and receive guidance on managing minor ailments at home.</p>

            <div class="disclaimer-box">
                <h3>‚öïÔ∏è Important Medical Disclaimer</h3>
                <p><strong>This is an AI assistant providing general health information only.</strong> It is not a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of your GP or other qualified health provider with any questions about your medical condition. In case of emergency, call 999 or visit your nearest A&E.</p>
            </div>

            <div class="services-grid" id="services">
                <div class="service-card" onclick="scrollToChat('I have symptoms I\'d like to check')">
                    <div class="service-icon">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/>
                        </svg>
                    </div>
                    <h3>Symptom Checker</h3>
                    <p>Describe your symptoms and get information about possible causes and home remedies for minor conditions.</p>
                </div>
                <div class="service-card" onclick="scrollToChat('How can I book a GP appointment?')">
                    <div class="service-icon">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11zM9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/>
                        </svg>
                    </div>
                    <h3>Appointments</h3>
                    <p>Get guidance on booking GP appointments, specialist consultations, and NHS services.</p>
                </div>
                <div class="service-card" onclick="scrollToChat('Find my nearest GP practice')">
                    <div class="service-icon">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                    </div>
                    <h3>Find Services</h3>
                    <p>Locate your nearest GP practice, pharmacy, hospital, or walk-in centre with contact information.</p>
                </div>
                <div class="service-card" onclick="scrollToChat('What are home remedies I can use?')">
                    <div class="service-icon">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 3h12v2H6zm11 3H7c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-1 9h-2.5v2.5h-3V15H8v-3h2.5V9.5h3V12H16v3z"/>
                        </svg>
                    </div>
                    <h3>Home Remedies</h3>
                    <p>Learn about self-care treatments for common conditions like colds, headaches, and minor injuries.</p>
                </div>
            </div>
        </section>

        <section class="chat-container" id="chat">
            <div class="chat-header">
                <h2>Chat with AI Health Assistant</h2>
                <div class="status-indicator"></div>
            </div>

            <div class="quick-actions">
                <button class="action-btn" onclick="askQuestion('I have a headache and fever. What should I do?')">ü§í I have a fever</button>
                <button class="action-btn" onclick="askQuestion('How can I book a GP appointment?')">üìÖ Book appointment</button>
                <button class="action-btn" onclick="askQuestion('What are home remedies for a cold?')">ü§ß Cold remedies</button>
                <button class="action-btn" onclick="askQuestion('Find my nearest GP practice')">üìç Find nearest GP</button>
            </div>

            <div class="messages" id="messages">
                <div class="message assistant">
                    <div class="message-avatar">üè•</div>
                    <div class="message-content">
                        <p>Hello! I'm your NHS AI Health Assistant. I'm here to help you with:</p>
                        <ul>
                            <li>Understanding common symptoms</li>
                            <li>Home remedies for minor ailments</li>
                            <li>Booking appointments</li>
                            <li>Finding NHS services near you</li>
                        </ul>
                        <div class="ai-disclaimer">
                            <strong>Remember:</strong> I'm an AI providing general information only. For serious symptoms or emergencies, please call 999 or contact your GP directly.
                        </div>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <input
                    type="text"
                    id="questionInput"
                    placeholder="Describe your symptoms or ask a health question..."
                    onkeypress="if(event.key === 'Enter') sendMessage()"
                >
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
            </div>
        </section>

        <section class="info-section" id="about">
            <h2>How Can We Help You?</h2>
            <div class="info-grid">
                <div class="info-card">
                    <div class="info-icon">ü§ñ</div>
                    <h3>AI-Powered Support</h3>
                    <p>Our AI assistant uses advanced natural language processing to understand your health concerns and provide evidence-based information from NHS resources.</p>
                </div>
                <div class="info-card">
                    <div class="info-icon">üîí</div>
                    <h3>Safe & Confidential</h3>
                    <p>Your conversations are private and secure. We follow NHS data protection standards to keep your health information safe.</p>
                </div>
                <div class="info-card">
                    <div class="info-icon">üìö</div>
                    <h3>NHS-Verified Information</h3>
                    <p>All medical information comes from trusted NHS sources and clinical guidelines to ensure accuracy and reliability.</p>
                </div>
                <div class="info-card">
                    <div class="info-icon">‚öïÔ∏è</div>
                    <h3>When to See a Doctor</h3>
                    <p>The AI will guide you on when to seek professional medical help. Call <a href="tel:111">NHS 24 (111)</a> for urgent advice or <a href="tel:999">999</a> for emergencies.</p>
                </div>
            </div>
        </section>
    </div>

    <footer class="nhs-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>Emergency Contacts</h4>
                <ul>
                    <li><strong>Emergency:</strong> <a href="tel:999">999</a></li>
                    <li><strong>NHS 24:</strong> <a href="tel:111">111</a></li>
                    <li><strong>Samaritans:</strong> <a href="tel:116123">116 123</a></li>
                    <li><strong>Childline:</strong> <a href="tel:08001111">0800 1111</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>NHS Services</h4>
                <ul>
                    <li><a href="https://www.nhsinform.scot" target="_blank">NHS Inform</a></li>
                    <li><a href="https://www.nhs24.scot" target="_blank">NHS 24</a></li>
                    <li><a href="#">Find a GP</a></li>
                    <li><a href="#">Book Appointment</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>About This Service</h4>
                <ul>
                    <li><a href="#about">How it Works</a></li>
                    <li><a href="/metrics" target="_blank">Service Status</a></li>
                    <li><a href="https://github.com/roger-rkd/ai-support-service" target="_blank">Source Code</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>For Developers</h4>
                <ul>
                    <li><a href="/docs" target="_blank">API Documentation</a></li>
                    <li><a href="/api" target="_blank">API Info</a></li>
                    <li><a href="/metrics" target="_blank">Prometheus Metrics</a></li>
                    <li><a href="https://github.com/roger-rkd/ai-support-service" target="_blank">GitHub Repository</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Made with ‚ù§Ô∏è by <strong>Rohit Kumar Dubey</strong></p>
            <p>Powered by Groq AI, Sentence Transformers, and FAISS | <a href="https://huggingface.co/spaces/dubey-codes/ai-support-service" target="_blank">Hugging Face Demo</a></p>
            <p style="margin-top: 1rem; font-size: 0.85rem;">‚ö†Ô∏è This AI assistant provides general health information only and is not a substitute for professional medical advice.</p>
        </div>
    </footer>

    <script>
        const messagesContainer = document.getElementById('messages');
        const questionInput = document.getElementById('questionInput');
        const sendBtn = document.getElementById('sendBtn');
        let messageCount = 0;

        async function sendMessage() {
            const question = questionInput.value.trim();
            if (!question) return;

            await askQuestion(question);
            questionInput.value = '';
        }

        async function askQuestion(question) {
            // Add user message
            addMessage(question, 'user');

            // Disable input
            questionInput.disabled = true;
            sendBtn.disabled = true;

            // Add loading indicator
            const loadingId = addLoadingMessage();

            try {
                const response = await fetch('/ask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ question: question })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Remove loading indicator
                removeLoadingMessage(loadingId);

                // Add assistant response with disclaimer
                addMessage(data.answer, 'assistant', true);

                messageCount++;

                // Show disclaimer reminder every 3 messages
                if (messageCount % 3 === 0) {
                    setTimeout(() => {
                        addDisclaimerReminder();
                    }, 500);
                }

            } catch (error) {
                console.error('Error:', error);
                removeLoadingMessage(loadingId);
                addMessage('I apologize, but I\'m having trouble processing your request right now. If you have an urgent medical concern, please call NHS 24 on 111 or 999 in an emergency.', 'assistant', true);
            } finally {
                // Re-enable input
                questionInput.disabled = false;
                sendBtn.disabled = false;
                questionInput.focus();
            }
        }

        function formatMessage(text) {
            // Escape HTML to prevent XSS but preserve bold markers
            const escapeHtml = (str) => {
                const div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML;
            };

            // Process bold text **text** -> <strong>text</strong>
            const processBold = (str) => {
                return str.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            };

            // Convert URLs to clickable links
            const processLinks = (str) => {
                // Match URLs starting with http:// or https:// or www.
                const urlPattern = /(https?:\/\/[^\s<]+|www\.[^\s<]+)/g;
                return str.replace(urlPattern, (url) => {
                    const href = url.startsWith('www.') ? 'https://' + url : url;
                    return `<a href="${href}" target="_blank" rel="noopener noreferrer">${url}</a>`;
                });
            };

            // Split into lines
            let lines = text.split('\n');
            let formatted = [];
            let inList = false;
            let listItems = [];
            let listType = null;

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();

                if (!line) {
                    // Empty line - close any open list and add spacing
                    if (inList) {
                        if (listType === 'numbered') {
                            formatted.push('<ol>' + listItems.join('') + '</ol>');
                        } else {
                            formatted.push('<ul>' + listItems.join('') + '</ul>');
                        }
                        inList = false;
                        listItems = [];
                        listType = null;
                    }
                    formatted.push('<br>');
                    continue;
                }

                // Check for numbered list (1. 2. 3. etc)
                const numberedMatch = line.match(/^(\d+)\.\s+(.+)$/);
                if (numberedMatch) {
                    if (!inList || listType !== 'numbered') {
                        if (inList) {
                            formatted.push('<ul>' + listItems.join('') + '</ul>');
                            listItems = [];
                        }
                        inList = true;
                        listType = 'numbered';
                    }
                    const itemText = processLinks(processBold(escapeHtml(numberedMatch[2])));
                    listItems.push('<li>' + itemText + '</li>');
                    continue;
                }

                // Check for bullet list (-, *, ‚Ä¢) but not bold markers
                const bulletMatch = line.match(/^[-‚Ä¢]\s+(.+)$/);
                if (bulletMatch && !line.startsWith('**')) {
                    if (!inList || listType !== 'bullet') {
                        if (inList) {
                            formatted.push('<ol>' + listItems.join('') + '</ol>');
                            listItems = [];
                        }
                        inList = true;
                        listType = 'bullet';
                    }
                    const itemText = processLinks(processBold(escapeHtml(bulletMatch[1])));
                    listItems.push('<li>' + itemText + '</li>');
                    continue;
                }

                // Regular line
                if (inList) {
                    if (listType === 'numbered') {
                        formatted.push('<ol>' + listItems.join('') + '</ol>');
                    } else {
                        formatted.push('<ul>' + listItems.join('') + '</ul>');
                    }
                    inList = false;
                    listItems = [];
                    listType = null;
                }

                const processedLine = processLinks(processBold(escapeHtml(line)));
                formatted.push('<p>' + processedLine + '</p>');
            }

            // Close any remaining list
            if (inList) {
                if (listType === 'numbered') {
                    formatted.push('<ol>' + listItems.join('') + '</ol>');
                } else {
                    formatted.push('<ul>' + listItems.join('') + '</ul>');
                }
            }

            return formatted.join('');
        }

        function addMessage(text, type, withDisclaimer = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = type === 'user' ? 'üë§' : 'üè•';

            const content = document.createElement('div');
            content.className = 'message-content';

            // Format the message for better readability
            if (type === 'assistant') {
                content.innerHTML = formatMessage(text);

                // Add disclaimer for AI responses
                if (withDisclaimer) {
                    const disclaimer = document.createElement('div');
                    disclaimer.className = 'ai-disclaimer';
                    disclaimer.innerHTML = '<strong>Note:</strong> This is AI-generated general advice. For serious concerns or if symptoms worsen, please contact your GP or call NHS 24 on 111.';
                    content.appendChild(disclaimer);
                }
            } else {
                content.textContent = text;
            }

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function addDisclaimerReminder() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message assistant';

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = '‚öïÔ∏è';

            const content = document.createElement('div');
            content.className = 'message-content';
            content.innerHTML = '<div class="ai-disclaimer"><strong>Friendly Reminder:</strong> I\'m an AI assistant providing general health information. If you\'re experiencing severe symptoms, worsening conditions, or have concerns about your health, please:<ul><li>Call your GP surgery directly</li><li>Call NHS 24 on <strong>111</strong> for urgent advice</li><li>Call <strong>999</strong> for life-threatening emergencies</li></ul>I\'m here to help with general questions, but your health professional knows best!</div>';

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function addLoadingMessage() {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message assistant';
            loadingDiv.id = 'loading-' + Date.now();

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'üè•';

            const content = document.createElement('div');
            content.className = 'message-content';

            const loading = document.createElement('div');
            loading.className = 'loading';
            loading.innerHTML = '<div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div>';

            content.appendChild(loading);
            loadingDiv.appendChild(avatar);
            loadingDiv.appendChild(content);

            messagesContainer.appendChild(loadingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            return loadingDiv.id;
        }

        function removeLoadingMessage(id) {
            const loadingMsg = document.getElementById(id);
            if (loadingMsg) {
                loadingMsg.remove();
            }
        }

        // Scroll to chat and optionally set question
        function scrollToChat(prefilledQuestion = '') {
            const chatSection = document.getElementById('chat');
            chatSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

            setTimeout(() => {
                if (prefilledQuestion) {
                    questionInput.value = prefilledQuestion;
                }
                questionInput.focus();
            }, 500);
        }

        // Focus input on load
        window.addEventListener('load', () => {
            questionInput.focus();
        });
    </script>
</body>
</html>
